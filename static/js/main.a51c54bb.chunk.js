(this["webpackJsonpfe-chat"]=this["webpackJsonpfe-chat"]||[]).push([[0],{67:function(e,t,a){},80:function(e,t,a){"use strict";a.r(t);var n,c,r,s,i,o,j=a(2),h=a(54),b=a.n(h),d=(a(67),a(8)),u=a(6),l=a(25),m=a(20),O=a(29),g=a(91),p=Object(g.a)(n||(n=Object(O.a)(["\n  query {\n    chats {\n      id\n      name\n      messages {\n        message\n        author\n        id\n        chatID\n      }\n    }\n  }\n"]))),x=Object(g.a)(c||(c=Object(O.a)(["\n  query findChat($id: ID) {\n    findChat(id: $id) {\n      name\n      id\n      messages {\n        message\n        author\n        id\n        chatID\n      }\n    }\n  }\n"]))),f=Object(g.a)(r||(r=Object(O.a)(["\n  mutation addMessage($message: String, $author: String, $chatID: ID) {\n    addMessage(message: $message, author: $author, chatID: $chatID) {\n      message\n      author\n      id\n    }\n  }\n"]))),v=Object(g.a)(s||(s=Object(O.a)(["\n  mutation createChat($name: String) {\n    createChat(name: $name) {\n      id\n      name\n    }\n  }\n"]))),y=Object(g.a)(i||(i=Object(O.a)(["\n  mutation deleteChat($chatID: ID) {\n    deleteChat(chatID: $chatID) {\n      id\n    }\n  }\n"]))),D=Object(g.a)(o||(o=Object(O.a)(["\n  subscription messageAdded($chatID: ID) {\n    messageAdded(chatID: $chatID) {\n      message\n      author\n      chatID\n      id\n    }\n  }\n"]))),C=a(94),I=a(96),w=a(97),N=a(3),$=function(e){var t=e.user,a=Object(u.h)().id,n=Object(u.g)(),c=Object(j.useState)(""),r=Object(d.a)(c,2),s=r[0],i=r[1],o=Object(j.useState)(null),h=Object(d.a)(o,2),b=h[0],O=h[1],g=Object(j.useState)(!1),v=Object(d.a)(g,2),$=v[0],S=v[1],q=Object(C.a)(x,{variables:{id:a}}),k=q.data,A=q.loading,Q=q.error,E=Object(I.a)(f),B=Object(d.a)(E,1)[0],J=Object(I.a)(y),L=Object(d.a)(J,1)[0];if(Object(w.a)(D,{variables:{chatID:a},onSubscriptionData:function(e){var t=e.subscriptionData,n=e.client;!function(e,t){var n,c;try{var r=t.readQuery({query:x,variables:{id:a}});n=r.findChat.messages,c=e,n.map((function(e){return e.id})).includes(c.id)||t.writeQuery({query:x,variables:{id:a},data:{findChat:Object(l.a)(Object(l.a)({},r.findChat),{},{messages:r.findChat.messages.concat(Object(l.a)(Object(l.a)({},e),{},{chatID:a}))})}})}catch(s){throw new Error("error from App.js trying to write to Cache from createChat",s.message)}}(t.data.messageAdded,n),clearTimeout(b);var c=setTimeout((function(){S(!0),L({variables:{chatID:a}});var e=n.readQuery({query:p});n.writeQuery({query:p,data:{chats:e.chats.filter((function(e){return e.id!==a}))}})}),6e5);O(c)}}),A||Q)return Object(N.jsx)("div",{class:"loading",children:Object(N.jsx)("img",{src:"../../public/Loading.svg",alt:"loading animation"})});var M=k.findChat,T=M.messages;return $&&n("/"),Object(N.jsxs)("div",{children:[Object(N.jsx)("header",{className:"chatroom-header",children:Object(N.jsxs)("div",{className:"chatroom-header-container",children:[Object(N.jsx)("h1",{children:M.name}),Object(N.jsx)(m.b,{to:"/rooms",children:Object(N.jsx)("button",{id:"back-button",children:"BACK"})})]})}),Object(N.jsxs)("section",{className:"chatroom-container",children:[Object(N.jsxs)("form",{onSubmit:function(e){return e.preventDefault(),void(s.length>0&&(B({variables:{message:s,author:t,chatID:a}}),i("")))},children:[Object(N.jsx)("input",{className:"chatroom-input",value:s,onChange:function(e){var t=e.target;return i(t.value)}}),Object(N.jsx)("button",{type:"submit",children:"Send"})]}),Object(N.jsx)("ul",{className:"chat-box",children:T.map((function(e){return Object(N.jsxs)("li",{className:t===e.author?"message user-message":"message",children:[Object(N.jsx)("span",{className:"message-author",children:e.author}),e.message]},e.id)}))})]})]})},S=a(27),q=function(){var e=Object(j.useState)(""),t=Object(d.a)(e,2),a=t[0],n=t[1],c=Object(I.a)(v,{update:function(e,t){try{var a=e.readQuery({query:p});e.writeQuery({query:p,data:{chats:[].concat(Object(S.a)(a.chats),[Object(l.a)(Object(l.a)({},t.data.createChat),{},{messages:[]})])}})}catch(n){throw new Error("error from App.js trying to write to Cache from createChat",n.message)}}}),r=Object(d.a)(c,1)[0],s=Object(C.a)(p),i=s.data,o=s.loading,h=s.error;if(o||h)return Object(N.jsx)("div",{class:"loading",children:Object(N.jsx)("img",{src:"../../public/Loading.svg",alt:"loading animation"})});var b=i.chats;return Object(N.jsxs)("div",{children:[Object(N.jsx)("header",{className:"chatroom-header",children:Object(N.jsx)("div",{className:"chatroom-header-container",children:Object(N.jsx)(m.b,{to:"/home",children:Object(N.jsx)("h1",{children:"ChatApp"})})})}),Object(N.jsxs)("section",{className:"chatroom-container",children:[Object(N.jsxs)("form",{id:"chatroom-form",onSubmit:function(e){return function(e){e.preventDefault(),r({variables:{name:a}}),n("")}(e)},children:[Object(N.jsx)("input",{className:"chatroom-input",placeholder:"chatroom name",value:a,onChange:function(e){var t=e.target;return n(t.value)}}),Object(N.jsx)("button",{type:"submit",children:"Create Chat"})]}),Object(N.jsx)("ul",{id:"chatroom-list",children:b.map((function(e){return Object(N.jsx)("li",{children:Object(N.jsx)(m.b,{to:e.id,children:Object(N.jsx)("button",{className:"chat-button",children:e.name})})},e.id)}))})]})]})},k=function(e){var t=e.user,a=e.setUser;return Object(N.jsx)("div",{className:"landing",children:Object(N.jsxs)("form",{children:[Object(N.jsx)("input",{id:"username-input",value:t,onChange:function(e){var t=e.target;return a(t.value)},placeholder:"username"}),Object(N.jsx)(m.b,{to:"/rooms",children:t?Object(N.jsx)("button",{className:"enter-button",type:"submit",children:"Enter"}):Object(N.jsx)("button",{className:"enter-button e-b-disabled",disabled:!0,children:"Enter"})})]})})};var A=function(){var e=Object(j.useState)(""),t=Object(d.a)(e,2),a=t[0],n=t[1];return Object(N.jsx)("div",{children:Object(N.jsxs)(u.d,{children:[Object(N.jsx)(u.b,{path:"/rooms/:id",element:Object(N.jsx)($,{user:a})}),Object(N.jsx)(u.b,{path:"/rooms",element:Object(N.jsx)(q,{})}),Object(N.jsx)(u.b,{path:"/home",element:Object(N.jsx)(k,{setUser:n,user:a})}),Object(N.jsx)(u.b,{path:"*",element:Object(N.jsx)(u.a,{to:"/home"})})]})})},Q=a(59),E=a(89),B=a(92),J=a(90),L=a(26),M=a(57),T=new(a(93).a)({typePolicies:{Query:{fields:{chats:{merge:!1}}}}}),U=Object(Q.a)({uri:"https://floating-spire-74284.herokuapp.com/graphql"}),K=new M.a({uri:"wss://floating-spire-74284.herokuapp.com/graphql",options:{reconnect:!0}}),P=Object(E.a)((function(e){var t=e.query,a=Object(L.e)(t);return"OperationDefinition"===a.kind&&"subscription"===a.operation}),K,U),z=new B.a({link:P,cache:T});b.a.render(Object(N.jsx)(J.a,{client:z,children:Object(N.jsx)(m.a,{children:Object(N.jsx)(A,{})})}),document.getElementById("root"))}},[[80,1,2]]]);
//# sourceMappingURL=main.a51c54bb.chunk.js.map