(this["webpackJsonpfe-chat"]=this["webpackJsonpfe-chat"]||[]).push([[0],{67:function(e,t,a){},80:function(e,t,a){"use strict";a.r(t);var n,c,r,s,i,o,j=a(2),h=a(54),b=a.n(h),u=(a(67),a(8)),d=a(6),l=a(25),O=a(20),m=a(29),g=a(91),x=Object(g.a)(n||(n=Object(m.a)(["\n  query {\n    chats {\n      id\n      name\n      messages {\n        message\n        author\n        id\n        chatID\n      }\n    }\n  }\n"]))),f=Object(g.a)(c||(c=Object(m.a)(["\n  query findChat($id: ID) {\n    findChat(id: $id) {\n      name\n      id\n      messages {\n        message\n        author\n        id\n        chatID\n      }\n    }\n  }\n"]))),p=Object(g.a)(r||(r=Object(m.a)(["\n  mutation addMessage($message: String, $author: String, $chatID: ID) {\n    addMessage(message: $message, author: $author, chatID: $chatID) {\n      message\n      author\n      id\n    }\n  }\n"]))),v=Object(g.a)(s||(s=Object(m.a)(["\n  mutation createChat($name: String) {\n    createChat(name: $name) {\n      id\n      name\n    }\n  }\n"]))),D=Object(g.a)(i||(i=Object(m.a)(["\n  mutation deleteChat($chatID: ID) {\n    deleteChat(chatID: $chatID) {\n      id\n    }\n  }\n"]))),y=Object(g.a)(o||(o=Object(m.a)(["\n  subscription messageAdded($chatID: ID) {\n    messageAdded(chatID: $chatID) {\n      message\n      author\n      chatID\n      id\n    }\n  }\n"]))),I=a(94),C=a(96),N=a(97),w=a(3),$=function(e){var t=e.user,a=Object(d.g)().id,n=Object(d.f)(),c=Object(j.useState)(""),r=Object(u.a)(c,2),s=r[0],i=r[1],o=Object(j.useState)(null),h=Object(u.a)(o,2),b=h[0],m=h[1],g=Object(j.useState)(!1),v=Object(u.a)(g,2),$=v[0],S=v[1],q=Object(I.a)(f,{variables:{id:a}}),A=q.data,Q=q.loading,E=q.error,k=Object(C.a)(p,{update:function(e,t){try{var n=e.readQuery({query:f,variables:{id:a}});e.writeQuery({query:f,variables:{id:a},data:{findChat:Object(l.a)(Object(l.a)({},n.findChat),{},{messages:n.findChat.messages.concat(Object(l.a)(Object(l.a)({},t.data.addMessage),{},{chatID:a}))})}})}catch(c){throw new Error("error from App.js trying to write to Cache from createChat",c.message)}}}),M=Object(u.a)(k,1)[0],R=Object(C.a)(D),B=Object(u.a)(R,1)[0];if(Object(N.a)(y,{variables:{chatID:a},onSubscriptionData:function(e){e.subscriptionData;var t=e.client;clearTimeout(b);var n=setTimeout((function(){S(!0),B({variables:{chatID:a}});var e=t.readQuery({query:x});t.writeQuery({query:x,data:{chats:e.chats.filter((function(e){return e.id!==a}))}})}),6e5);m(n)}}),Q||E)return Object(w.jsx)("h1",{style:{color:"white"},children:"LOADING/ERROR"});var G=A.findChat,J=G.messages;return $&&n("/"),Object(w.jsxs)("div",{children:[Object(w.jsx)("header",{className:"chatroom-header",children:Object(w.jsxs)("div",{className:"chatroom-header-container",children:[Object(w.jsx)("h1",{children:G.name}),Object(w.jsx)(O.b,{to:"/rooms",children:Object(w.jsx)("button",{id:"back-button",children:"BACK"})})]})}),Object(w.jsxs)("section",{className:"chatroom-container",children:[Object(w.jsxs)("form",{onSubmit:function(e){return e.preventDefault(),void(s.length>0&&(M({variables:{message:s,author:t,chatID:a}}),i("")))},children:[Object(w.jsx)("input",{className:"chatroom-input",value:s,onChange:function(e){var t=e.target;return i(t.value)}}),Object(w.jsx)("button",{type:"submit",children:"Send"})]}),Object(w.jsx)("ul",{className:"chat-box",children:J.map((function(e){return Object(w.jsxs)("li",{className:t===e.author?"message user-message":"message",children:[Object(w.jsx)("span",{className:"message-author",children:e.author}),e.message]},e.id)}))})]})]})},S=a(27),q=function(){var e=Object(j.useState)(""),t=Object(u.a)(e,2),a=t[0],n=t[1],c=Object(C.a)(v,{update:function(e,t){try{var a=e.readQuery({query:x});e.writeQuery({query:x,data:{chats:[].concat(Object(S.a)(a.chats),[Object(l.a)(Object(l.a)({},t.data.createChat),{},{messages:[]})])}})}catch(n){throw new Error("error from App.js trying to write to Cache from createChat",n.message)}}}),r=Object(u.a)(c,1)[0],s=Object(I.a)(x),i=s.data,o=s.loading,h=s.error;if(o||h)return Object(w.jsx)("h1",{children:"LOADING"});var b=i.chats;return Object(w.jsxs)("div",{children:[Object(w.jsx)("header",{className:"chatroom-header",children:Object(w.jsx)("div",{className:"chatroom-header-container",children:Object(w.jsx)(O.b,{to:"/",children:Object(w.jsx)("h1",{children:"ChatApp"})})})}),Object(w.jsxs)("section",{className:"chatroom-container",children:[Object(w.jsxs)("form",{id:"chatroom-form",onSubmit:function(e){return function(e){e.preventDefault(),r({variables:{name:a}}),n("")}(e)},children:[Object(w.jsx)("input",{className:"chatroom-input",placeholder:"chatroom name",value:a,onChange:function(e){var t=e.target;return n(t.value)}}),Object(w.jsx)("button",{type:"submit",children:"Create Chat"})]}),Object(w.jsx)("ul",{id:"chatroom-list",children:b.map((function(e){return Object(w.jsx)("li",{children:Object(w.jsx)(O.b,{to:e.id,children:Object(w.jsx)("button",{className:"chat-button",children:e.name})})},e.id)}))})]})]})},A=function(e){var t=e.user,a=e.setUser;return Object(w.jsx)("div",{className:"landing",children:Object(w.jsxs)("form",{children:[Object(w.jsx)("input",{id:"username-input",value:t,onChange:function(e){var t=e.target;return a(t.value)},placeholder:"username"}),Object(w.jsx)(O.b,{to:"/rooms",children:t?Object(w.jsx)("button",{className:"enter-button",type:"submit",children:"Enter"}):Object(w.jsx)("button",{className:"enter-button",id:"enter-button",disabled:!0,children:"Enter"})})]})})};var Q=function(){var e=Object(j.useState)(""),t=Object(u.a)(e,2),a=t[0],n=t[1];return Object(w.jsx)("div",{children:Object(w.jsxs)(d.c,{children:[Object(w.jsx)(d.a,{path:"/rooms/:id",element:Object(w.jsx)($,{user:a})}),Object(w.jsx)(d.a,{path:"/rooms",element:Object(w.jsx)(q,{})}),Object(w.jsx)(d.a,{path:"/",element:Object(w.jsx)(A,{setUser:n,user:a})})]})})},E=a(59),k=a(89),M=a(92),R=a(90),B=a(26),G=a(57),J=new(a(93).a)({typePolicies:{Query:{fields:{chats:{merge:!1}}}}}),L=Object(E.a)({uri:"http://localhost:4000/graphql"}),T=new G.a({uri:"ws://localhost:4000/graphql",options:{reconnect:!0}}),U=Object(k.a)((function(e){var t=e.query,a=Object(B.e)(t);return"OperationDefinition"===a.kind&&"subscription"===a.operation}),T,L),K=new M.a({link:U,cache:J});b.a.render(Object(w.jsx)(R.a,{client:K,children:Object(w.jsx)(O.a,{children:Object(w.jsx)(Q,{})})}),document.getElementById("root"))}},[[80,1,2]]]);
//# sourceMappingURL=main.c820ab60.chunk.js.map